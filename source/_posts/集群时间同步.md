---
title: 【笔记】集群时间同步（CentOS篇）
categories:
  - Big Data
date: 2020-02-05 13:30:32
---

## 前言

通过`ntp`命令，配置集群时间同步，实现内网时间同步

<!-- more -->

## 配置主机

- 配置`hadoop102`

### 确保 ntp 服务关闭状态

- 为防止端口占用，在配置前应关闭`ntp`服务

#### 查看 ntp 服务状态

``` sh
service ntpd status
```

#### 停止 ntp 服务

``` sh
service ntpd stop
chkconfig ntpd off
```

#### 确认关闭状态

``` sh
chkconfig --list ntpd
```

### 开始配置

- `ntp`所有命令应在`root`权限下使用

- 把`hadoop102`配置中心服务器，`hadoop103`、`hadoop104`去`hadoop102`上拉去时间

#### 配置 ntp.conf

##### 编辑 ntp.conf 文件

``` sh
vim /etc/ntp.conf
```

##### 去除注释

- 为以下内容去除注释

`restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap`

##### 添加注释

- 为以下内容添加注释

`server 0.centos.pool.ntp.org iburst`
`server 1.centos.pool.ntp.org iburst`
`server 2.centos.pool.ntp.org iburst`
`server 3.centos.pool.ntp.org iburst`

##### 添加当前节点

- 在任意位置添加当前节点

``` sh
server 127.127.1.0
fudge 127.127.1.0 stratum 10
```

#### 配置 ntpd

##### 编辑 ntpd 文件

``` sh
vim /etc/sysconfig/ntpd
```

##### 同步硬件时钟

- 添加以下内容

``` sh
SYNC_HWCLOCK=yes
```

### 重启 ntp 服务

``` sh
service ntpd start
```

#### 确认 ntp 服务状态

``` sh
service ntpd status
```

### 设置 ntp 服务开机启动

``` sh
chkconfig ntpd on
```

## 配置从机

- 配置`hadoop103`、`hadoop104`

### 添加计划任务

``` sh
crontab -e
```

#### 配置计划任务

- 每隔1分钟同步时间

``` sh
*/1 * * * * /usr/sbin/ntpdate hadoop102
```

## 完成

## 参考文献

[哔哩哔哩——zhvsvd](https://www.bilibili.com/video/av64039568)

