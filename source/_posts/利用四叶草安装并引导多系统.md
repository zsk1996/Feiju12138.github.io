---
title: 【踩坑】利用四叶草安装并引导多系统
date: 2019-12-10 19:50:43
tags:
categories:
- 系统安装
---

## 前言

经过不懈的努力，终于将多种操作系统安装在同一硬盘下，并成功用四叶草引导

<!-- more -->

## 安装前的预算

- 我使用机器为机房的戴尔台式机，硬盘大小为1T，所以我决定先做4种系统的安装测试，硬盘分配及安装顺序，如下表：

因为仅作为实验用，而不用于办公，所以硬盘分配大小稍微较小

|安装顺序|系统|硬盘分配大小|
|----|----|----|
|1|MacOS|128G|
|2|Windows8|128G|
|3|Ubuntu|64G|
|4|CentOS|64G|

## 准备工作

- 8G以上的用于烧录各种系统安装盘的U盘（最好不含8G）

- 制作好大白菜系统维护盘的U盘（WindowsPE）

- 额外的可以开机联网查资料的电脑（任何我未提及的坑，请自行查百度）

## 第一次分区

- 插入系统维护U盘，进入WindowsPE系统，使用`DiskGenius`工具，全盘删除分区

- 创建ESP分区，分区大小512M

其实可以分更小的区，我只是为了确保足够用

- 创建NTFS分区128G用于安装黑苹果，保存并格式化

## 安装黑苹果

- 首先安装黑苹果，是因为我使用的黑苹果安装包为懒人包（系统映像+四叶草引导），四叶草引导已经写入安装包，所以优先安装可以便于引导其他系统

- 在上一个步骤分盘时，应分出128GNTFS格式的硬盘，然后进入MacOS实用工具，再使用实用工具格式化成MacOS（日志式）格式，不要直接使用`DiskGenius`分出128GMacOS（日志式）分区

[传送门](https://feiju12138.github.io/2019/11/15/安装黑苹果系统/)

- 安装完成的第一件事就是将四叶草引导加入系统的EFI分区

[传送门](https://feiju12138.github.io/2019/11/15/将四叶草引导植入硬盘/)

## 第二次分区

- 创建128G新分区，格式为NTFS，保存并格式化

## 安装Windows

- 第二个安装的是Windows操作系统，我第一次实验的时候安装的Windows10，但由于中途研究其他系统时引导被自动替换，所以第二次实验的时候安装的Windows8

不是说Windows10不能成功，只是说我想尽可能多的多尝试新系统的安装，而后记录笔记

[传送门](https://feiju12138.github.io/2019/12/10/安装Windows8系统/)

- 安装完后，为了便于分盘操作，我下载了Windows UEFI版大白菜，使用了将WindowsPE系统安装在电脑上

事实上`大白菜`安装到系统后，并不是独立一个分区通过引导启动，而是融入Windows系统中，所以在引导到Windows启动之后，再选择`大白菜`进入PE系统

- 此时四叶草的引导，不需要修改任何内容，仍然可以自动识别到黑苹果和Windows，为了安全起见，使用`DiskGenius`工具进入EFI分区，点击`浏览文件`，进入EFI文件夹，此时可以看到如下文件夹，将他们保存到U盘备份以防止覆盖

> `APPLE`：MacOS的引导
> `BOOT`：普通UEFI引导
> `CLOVER`：四叶草引导
> `Microsoft`：Windows的引导

## 第三次分区

- 新建一个64G的分区，格式为ext4（或者仍然格式化为NTFS，等到安装Ubuntu的时候再重新格式化）

## 安装Ubuntu

[传送门](https://feiju12138.github.io/2019/11/16/安装UbuntuLinux系统/)

- 在`安装类型`阶段选择`其他选项`，至少设置一个挂在点为`/`根目录，格式为ext4

- 安装Ubuntu成功后可能会遇到引导无效，进入PE，使用`DiskGenius`工具

- 插入可存储文件的U盘（可以是大白菜U盘）

- 找到四叶草的配置文件`config.plist`

/EFI分区/EFI文件夹/CLOVER/config.plist

- 复制`config.plist`，拷贝到其他能正常使用的电脑上

- 编辑`config.plist`，找到`GUI`关键字，修改内容案例如下

``` bash
<key>GUI</key>
    <dict>
        <key>Theme</key>
        <string>SimpleThemeDark</string>
        <key>Custom</key>
        <dict>
            <key>Entries</key>
            <array>
                <dict>
                    <key>Disabled</key>
                    <false/>
                    <key>Ignore</key>
                    <false/>
                    <key>Path</key>
                    <string>\EFI\MICROSOFT\BOOT\BOOTMGFW.EFI</string>
                    <key>Title</key>
                    <string>Windows</string>
                    <key>Type</key>
                    <string>Windows</string>
                    <key>VolumeType</key>
                    <string>Internal</string>
                </dict>
            </array>
        </dict>
    </dict>
```

- 复制`<dict></dict>`标签，修改`string<></string>`标签内容为ubuntu的EFI参数

\EFI\ubuntu\grubx64.efi

- 将修改后的文件覆盖系统上的原文件

## 第四次分区

- 创建64G新分区，格式为ext4

## 安装CentOS

[传送门](https://feiju12138.github.io/2019/12/10/安装CentOSLinux系统/)

- 和Ubuntu大同小异，在`安装目标位置`步骤，在`存储配置`选项选择`自定义`，至少设置一个根目录的挂载点`/`，并且可以设置`efi`存放位置`/boot/efi`

- 遇到的问题仍然是可能会出现EFI被覆盖，记得在安装前备份EFI分区的所有内容，安装过后修改四叶草的配置文件

## 完成

- 此次多系统安装之旅告一段落，所有系统经测试均能正常使用，以上是最基本的4种操作系统（换句话说是3种操作系统，其中两个都是Linux系统，只不过所属类别不同，仍然有差异），更多的操作系统例如`Red Hat`，几乎是操作相同，所以仍然可以继续安装

- 最后附上成功案例截图（使用的`黑果小兵`制作的四叶草中F10截图功能），希望大家都能折腾成功

![01.gif](/images/20191210195043/01.gif)

## 参考文献

[黑果小兵部落阁](https://blog.daliansky.net/clover-user-manual.html)
[Orcim的博客](https://www.cnblogs.com/Orcim/p/11065755.html)

