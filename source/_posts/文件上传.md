---
title: 【代码】文件上传
categories:
  - Java
date: 2020-05-13 16:01:56
---

## 前言

Javaweb实现文件上传

<!-- more -->

## 准备工作

- 导入jar包

将`commons-io-2.4.jar`、`commons-fileupload-1.2.2.jar`放到项目的`/WebContent/WEB-INF/lib`目录下

- 在项目的`/WebContent`目录下新建用于存放上传的文件的目录`file`

## 前端页面代码

- 在`/WebContent`目录下新建`index.html`

``` html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
    <h1 align="center">文件上传</h1><br>
    <form action="upload" method="post" enctype="multipart/form-data">
        <input type="file" name="myfile"><br>
        <input type="submit" value="上传">
    </form>
</body>
</html>
```

## Servlet代码

- 在包下新建`Upload.java`

``` java
package io.github.feiju12138;

import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.fileupload.FileItemIterator;
import org.apache.commons.fileupload.FileItemStream;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

public class Upload extends HttpServlet {
    private static final long serialVersionUID = 1L;
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        this.doPost(req, resp);
    }
    
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        
        // 声明输入缓冲流
        InputStream is = null;
        // 声明文件输出流
        FileOutputStream fos = null;
        // 创建上传文件对象
        ServletFileUpload upload = new ServletFileUpload();
        
        try {
            
            // 把上传的文件转换为迭代器
            FileItemIterator iterator = upload.getItemIterator(req);
            
            // 遍历文件流中的字节
            while(iterator.hasNext()) {
                
                // 取出一个文件
                FileItemStream fis = iterator.next();
                
                // 开启输入缓冲流
                is = fis.openStream();
                
                // 获取文件存放路径
                String path = this.getServletContext().getRealPath("file");
                path += "/" + fis.getName();
                
                // 创建文件输出流
                fos = new FileOutputStream(path);
                
                // 将文件输出到指定目录
                byte buf[] = new byte[1024];
                int len = 0;
                while((len = is.read(buf)) > 0) {
                    fos.write(buf, 0, len);
                }
                
            }
        } catch (FileUploadException e) {
            e.printStackTrace();
        } finally {
            
            // 关闭文件输出流
            if(fos != null) {
                fos.close();
            }
            
            // 关闭文件缓冲流
            if(is != null) {
                is.close();
            }
            
        }
        
    }
    
}
```

## 参考文献

达内教育

