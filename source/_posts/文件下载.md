---
title: 【代码】文件下载
categories:
  - Java
date: 2020-05-14 08:50:52
---

## 前言

Javaweb实现文件下载

<!-- more -->

## 前端页面代码

- 在`/WebContent`目录下新建`download.html`

``` html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
    <h1 align="center">文件下载</h1><br>
    <a href="download">下载</a>
</body>
</html>
```

## Servlet代码

- 在`/WebContent`目录下新建一个`file`目录，在`/WebContent/file`目录下复制一个资源名为`1.jpg`

- 在包下新建`DownloadServlet.java`，访问路径修改为`/download`

``` java
package io.github.feiju12138;

import java.io.FileInputStream;
import java.io.IOException;
import java.net.URLEncoder;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class DownloadServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        this.doPost(req, resp);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        // 1. 获取资源
        String path = getServletContext().getRealPath("/file");
        String fileName = "1.jpg";
        path += "/" + fileName;

        // 2. 设置响应头
        resp.setHeader("content-disposition", "attachment; filename=" + URLEncoder.encode(fileName, "utf-8"));

        // 3. 文件下载
        FileInputStream fis = null;
        try {
            fis = new FileInputStream(path);
            byte buf[] = new byte[1024];
            int len = 0;
            while((len = fis.read(buf)) > 0) {
                resp.getOutputStream().write(buf, 0, len);
            }
        } catch (Exception e) {
            // TODO: handle exception
        } finally {
            if(fis != null) {
                fis.close();
            }
        }

    }

}
```

## 完成

## 参考文献

达内教育

